# Local Staging Environment

Mirrors the VPS production setup on your Mac for testing changes before deploying.

## Prerequisites

- Docker (with Compose v2)
- 1Password CLI (`op`) authenticated to `my.1password.com`
- `gog` CLI installed and authenticated
- SSH access to VPS (`root@100.71.224.113`)

## One-Time Setup

1. **Create a staging Telegram bot** via BotFather:
   - `/newbot` → name: "mhive staging" → handle: something like `@mhive_stage_bot`
   - Save the token to 1Password: item `"Staging Telegram Bot"` in OpenClaw vault, `credential` field

2. **Run the start script:**
   ```bash
   bash mhive-ops/staging/start.sh
   ```
   This will: sync from VPS, inject secrets, build the Docker image, patch config, and start containers.

## Daily Usage

| Command                             | What it does                                            |
| ----------------------------------- | ------------------------------------------------------- |
| `bash mhive-ops/staging/start.sh`   | Full startup (sync + build + start)                     |
| `bash mhive-ops/staging/stop.sh`    | Stop all staging containers                             |
| `bash mhive-ops/staging/rebuild.sh` | Rebuild image from local source + restart (no VPS sync) |
| `bash mhive-ops/staging/sync.sh`    | Pull latest VPS state + patch + restart                 |

## Testing Code Changes

1. Edit source code
2. `bash mhive-ops/staging/rebuild.sh`
3. Message the staging Telegram bot to verify

## Architecture

```
~/.openclaw-staging/          ← staging state (mirrored from VPS)
docker-compose.staging.yml    ← compose override (maple-proxy, gog, venv bootstrap)
.env.staging                  ← secrets + paths (gitignored, generated by start.sh)
mhive-ops/staging/            ← scripts and templates (committed)
```

Staging uses a single Telegram bot bound to the `main` agent. WhatsApp is disabled.
