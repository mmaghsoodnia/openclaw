# Session Log — 2026-02-25

## Summary

**Emergency fix: WhatsApp channel sending unsolicited pairing messages to random contacts.**

## Problem

After WhatsApp was connected via `whatsapp_login`, the bot began auto-replying pairing codes to every person who messaged the linked WhatsApp number. This is caused by the default `dmPolicy: "pairing"` — when no `channels.whatsapp` config block exists, every unknown sender gets a pairing code reply. During reconnection cycles, historical/queued messages can trigger mass fan-out.

Known upstream bug: [Issue #834](https://github.com/openclaw/openclaw/issues/834) (closed, fix on main). Additional open risks: [Issue #22599](https://github.com/openclaw/openclaw/issues/22599) (persisted pairings bypass allowlist), [Issue #25975](https://github.com/openclaw/openclaw/issues/25975) (allowlist mode still sends pairing messages).

## Root Cause

1. WhatsApp plugin was enabled (`plugins.entries.whatsapp.enabled = true`)
2. No `channels.whatsapp` config block existed — all defaults applied
3. Default `dmPolicy` is `"pairing"` (`access-control.ts:41`)
4. Every incoming DM from a non-allowlisted number triggered an auto-reply with a pairing code (`access-control.ts:148-170`)
5. The `suppressPairingReply` guard only covers messages older than 30 seconds before connection time — narrow window

## Fix Applied

1. **Added `channels.whatsapp`** to `/root/.openclaw/openclaw.json`:
   - `dmPolicy: "allowlist"` — only allowlisted numbers can interact
   - `allowFrom: ["+16502079189"]` — owner's number only
   - `groupPolicy: "disabled"` — no group messages
2. **Cleared `whatsapp-pairing.json`** — removed persisted pairing request (Scarlett Chen +852...)
3. **Restarted gateway** — config change picked up, WhatsApp reconnected with strict allowlist

## Files Modified (VPS only — not in git)

- `/root/.openclaw/openclaw.json` — added `channels.whatsapp` block
- `/root/.openclaw/credentials/whatsapp-pairing.json` — cleared to `{}`

## Files Modified (local repo — committed)

- `TODO.md` — marked WhatsApp connection complete, documented incident and fix, added follow-up item
- `mhive-ops/sessions/2026-02-25.md` — this session log

## Remaining Risks

- **Issue #22599 (OPEN):** Persisted pairings from the allow-store are merged with `allowFrom` at runtime. If someone gets paired, they bypass the allowlist even after being removed. Periodically check/clear `whatsapp-pairing.json`.
- **Issue #25975 (OPEN):** Even in `allowlist` mode, the bot may still send pairing messages to non-allowed senders in some edge cases.
- **Gateway disconnects (Issue #22511):** WhatsApp connection drops every ~30 minutes with no auto-recovery. Each reconnect is a potential risk window.
- **Fork may be behind upstream:** Check if upstream `main` has fixes for #834, #22599, #25975 and merge if available.
