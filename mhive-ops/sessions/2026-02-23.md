# Session Log — 2026-02-23

## Summary

Fixed PolyHive Polymarket betting system that broke during VPS migration. Root cause: Python venv built with Python 3.14 on Mac Studio, but Docker container runs Python 3.11. Rebuilt venv inside the container, migrated credentials to 1Password, and verified end-to-end.

## What Was Done

### 1. Root Cause Analysis
- Explored VPS agent config (`openclaw.json`): 14 agents, 3 Telegram bots, all channel bindings intact
- Found `the-hive/` workspace with Python trading scripts using `py_clob_client`
- Identified root cause: `.venv/` was a broken stub (0 packages), `venv/` had packages built for Python 3.14 (Mac Studio) — incompatible with container's Python 3.11
- Container also lacked `pip` and `python3-venv` packages

### 2. Polymarket Credentials → 1Password
- Created "Polymarket Wallet" item in OpenClaw vault (fields: private_key, funder_address, chain_id, signature_type)
- Created "Polymarket API" item in OpenClaw vault (fields: host, gamma_api_base_url)
- Created `.env.tpl` template on VPS at `/root/.openclaw/workspace/the-hive/.env.tpl`
- Generated `.env` via `op inject --account my.1password.com -i .env.tpl -o .env`
- Set permissions: `chmod 600 .env`, `chown ubuntu:ubuntu .env` (maps to `node` uid 1000 in container)
- Redacted hardcoded private key from `hive-trader/RUNBOOK.md` using sed

### 3. Python Venv Rebuild (Inside Docker Container)
- Installed `python3-pip python3-venv` inside container via `docker exec -u root`
- Created venv with Python 3.11: `python3 -m venv /home/node/.openclaw/workspace/the-hive/venv`
- Installed packages: `py-clob-client python-dotenv requests`
- All done as `node` user (uid 1000) so permissions match the running process

### 4. End-to-End Verification (All Passed)
- `py_clob_client` import: OK
- Market scanner (`fetch-soccer-markets.py --days 7 --summary`): 10 events, 113 unique slugs, live data from all 8 leagues (EPL, La Liga, Serie A, Bundesliga, Ligue 1, UCL, UEL, MLS)
- Wallet check (`check_wallet.py`): CLOB API connected, derived keys work, found live SELL order on-chain

### 5. Agent Self-Heal Notification
- Drafted message for user to send via mhive (chief of staff) to PolyHive agents:
  - Scout: remove TROUBLESHOOTING MODE, resume scans, update `.venv` → `venv` in RUNBOOK
  - Trader: update `.venv` → `venv` in RUNBOOK, private key now loaded from `.env`
  - All agents: correct activation path is `source the-hive/venv/bin/activate`

## Known Issues (Not Caused by Migration)
- **Wallet/funder address mismatch** — wallet address and funder address differ (may be a proxy/safe setup)
- **Zero USDC balance** — wallet has no funds for trading
- **Venv is ephemeral** — built inside running container, will be lost on `docker compose up -d` rebuild. Needs Dockerfile change or startup script.

## Files Created/Modified

| File | Location | Action |
|------|----------|--------|
| `.env.tpl` | VPS: `/root/.openclaw/workspace/the-hive/` | Created — 1Password template |
| `.env` | VPS: `/root/.openclaw/workspace/the-hive/` | Regenerated via `op inject` |
| `RUNBOOK.md` | VPS: `/root/.openclaw/workspace/hive-trader/` | Redacted hardcoded private key |
| `venv/` | VPS (container): `/home/node/.openclaw/workspace/the-hive/` | Rebuilt with Python 3.11 |
| 1Password | OpenClaw vault | Added "Polymarket Wallet" + "Polymarket API" items |
| `TODO.md` | `~/Projects/openclaw/` | Updated with completed items + notes |

## Errors Encountered & Resolutions

- **`op item create` on VPS: permission denied** — VPS service account is read-only. Ran from Mac using desktop app integration instead.
- **`python3 -m venv`: ensurepip not available** — Installed `python3-venv` on VPS host. Later realized host venv (Python 3.13) wouldn't work in container (Python 3.11), so built inside container instead.
- **`.env` PermissionError in container** — File written by root via `op inject`, container runs as `node` (uid 1000 = `ubuntu` on host). Fixed with `chown ubuntu:ubuntu`.

## What Remains
- Make Python venv persistent (Dockerfile or startup script)
- User sends agent self-heal message via mhive
- Expand Scout beyond soccer (add `--category` or `--all` flag)
- Connect WhatsApp channel
- Enable voice channels with ElevenLabs
- Rotate exposed secrets (ElevenLabs API key, Google OAuth client secret)
