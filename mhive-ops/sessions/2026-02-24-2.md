# Session Log — 2026-02-24 (Session 2)

## Summary

Closed out the three highest-priority TODO items from the 2026-02-22 security incident:
rotated both exposed secrets and made the Python venv persistent in Docker. The hive is
now in a clean state with no outstanding security debt.

## What Was Done

### 1. Secrets Rotations Confirmed Complete

User confirmed both rotations were completed externally:

- **ElevenLabs Talk API Key** — Regenerated in dashboard, updated in 1Password, injected
  into `openclaw.json` via `op inject`. Marked done in TODO.md.
- **Google OAuth client secret** — Rotated in Google Cloud Console, updated in 1Password,
  re-authenticated via `gog auth`. Marked done in TODO.md.

Both items moved from TODO → Completed in TODO.md and committed.

### 2. Python Venv — Full Persistence Fix

**Root cause analysis:**
- The venv at `/root/.openclaw/workspace/the-hive/venv/` IS bind-mounted (survives
  container rebuilds) — the venv itself was never at risk of being wiped.
- The actual gap: `python3-pip` and `python3-venv` were installed via ephemeral `apt-get`
  inside the running container. A fresh container can't recreate the venv if it gets
  deleted/corrupted.
- Additionally, no `requirements.txt` existed to record what packages to install.

**What was implemented:**

1. **`Dockerfile`** (committed to fork) — Added a permanent `RUN apt-get install
   python3-pip python3-venv` step after the `OPENCLAW_DOCKER_APT_PACKAGES` block.
   These tools are now baked into every image rebuild.

2. **`/root/.openclaw/workspace/the-hive/requirements.txt`** (created on VPS) — Pinned
   the four key packages at verified-working versions:
   ```
   py-clob-client==0.34.6
   python-dotenv==1.2.1
   requests==2.32.5
   httpx==0.28.1
   ```

3. **`/root/openclaw/docker-compose.override.yml`** (updated on VPS) — Added a startup
   venv health-check command wrapper to `openclaw-gateway`:
   ```bash
   # Runs at every container start:
   if ! $VENV/bin/python3 -c 'import py_clob_client' 2>/dev/null; then
     # Recreates venv from requirements.txt — logs [startup] messages
   fi
   exec node dist/index.js gateway --bind lan --port 18789
   ```
   If the venv is healthy, it passes through silently. If missing/broken, it auto-
   bootstraps and logs `[startup] Python venv missing or broken -- bootstrapping`.
   Uses `||` so the gateway always starts even if bootstrap fails.

4. **Deployed** — ran `./mhive-ops/deploy-vps.sh --skip-push`. New image built with
   Python tools (build took ~114s). Container recreated. Verified:
   - `docker inspect` confirms container is using our command wrapper (not the old CMD)
   - `py_clob_client` imports cleanly inside the container
   - No `[startup]` messages → venv was healthy → check passed silently

### 3. Files Created / Modified

| File | Location | Action |
|---|---|---|
| `Dockerfile` | Mac / GitHub fork | Added `RUN apt-get install python3-pip python3-venv` |
| `requirements.txt` | VPS `/root/.openclaw/workspace/the-hive/` | Created with 4 pinned packages |
| `docker-compose.override.yml` | VPS `/root/openclaw/` | Added startup venv health-check command |
| `TODO.md` | Mac / GitHub fork | Moved 3 items to Completed |
| `mhive-ops/sessions/2026-02-24-2.md` | Mac / GitHub fork | This file |

## What Remains

Two TODO items open:

1. **Connect WhatsApp channel** — Message mhive → trigger `whatsapp_login` tool → scan QR.
   No manual `openclaw.json` editing.

2. **Enable voice for agents** — ElevenLabs blocker is cleared. Next: configure `talk`
   section per-agent in `openclaw.json` with desired voice IDs. Telegram voice notes first.

## Notes / Gotchas

- The venv check runs as the `node` user (uid 1000). The workspace is owned by this user
  inside the container (`node:node`), so writes succeed.
- The `$$VENV` in docker-compose YAML escapes to `$VENV` in the bash script — docker-compose
  would otherwise try to interpolate `$VENV` from `.env` (where it doesn't exist).
- `${OPENCLAW_GATEWAY_BIND:-lan}` is intentionally NOT escaped — docker-compose interpolates
  it from `.env` at startup time, which is the correct behavior.
- hive-trader RUNBOOK activation path `source ../the-hive/venv/bin/activate` is unchanged.
  No agent notification needed (venv path identical, behavior improved but transparent).
